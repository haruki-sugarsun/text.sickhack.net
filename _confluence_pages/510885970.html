---
layout: single
title: "Design Docs - Site Converter Rough Design"
date: "2023-02-26T03:33:31.929Z"
toc: true
toc_sticky: true
tags:
  - designdoc
---
<div></div>
<h1 id="DesignDocs-SiteConverterRoughDesign-Overview">
 Overview
</h1>
<p>
 This page roughly describes the system which generates and serves Jekyll (GitHub Pages) site backed by Confluence Cloud instance.
</p>
<p>
 The author can edit the content in the Confluence Cloud, GitHub Actions fetches and converts them into data for Jekyll, GitHub Pages serves the content with configured custom domain.
</p>
<h1 id="DesignDocs-SiteConverterRoughDesign-InvolvedComponents">
 Involved Components
</h1>
<ul>
 <li>
  <p>
   Atlassian Confluence Cloud instance
  </p>
 </li>
 <li>
  <p>
   GitHub Repository
  </p>
  <ul>
   <li>
    <p>
     <a href="https://github.com/haruki-sugarsun/text.sickhack.net" data-card-appearance="inline" class="external-link" rel="nofollow">https://github.com/haruki-sugarsun/text.sickhack.net</a>  and <code>gh-pages</code> branch.
    </p>
   </li>
   <li>
    <p>
     Actions to automatically fetch and convert content <a href="https://github.com/haruki-sugarsun/text.sickhack.net/actions" data-card-appearance="inline" class="external-link" rel="nofollow">https://github.com/haruki-sugarsun/text.sickhack.net/actions</a>
    </p>
   </li>
  </ul>
 </li>
 <li>
  <p>
   GitHub Pages
  </p>
  <ul>
   <li>
    <p>
     with a custom domain
    </p>
   </li>
  </ul>
 </li>
</ul>
<h1 id="DesignDocs-SiteConverterRoughDesign-Diagram">
 Diagram
</h1>
<div>
 <div>
  <pre>                         +--------------------------------------------------------+
                         | text.sickhack.net repository                           |
                         |                                                        |
                         |                                                        |
+------------------+     |  +-------------------------+    +-------------------+  |
|Confluence        |     |  | GitHub Actions          |    | gh-pages branch   |  |
|                  |     |  |                         |    |                   +--+-&gt;text.sickhack.net
|  -page content   +-----|-&gt;|  -Recursive fetch       +---&gt;|  -Jekyll          |  |
|  -editor         |fetch|  |  -Metadata processing   |push|                   |  |
|  -attachments    | by  |  |  -HTML Conversion       |    +-------------------+  |
|                  | REST|  |  -Rule-based extra      |                           |
+------------------+     |  |                         |                           |
                         |  +-------------------------+                           |
                         |                                                        |
                         +--------------------------------------------------------+</pre>
 </div>
</div>
<p>
 (powered by <a href="https://asciiflow.com/#/" class="external-link" rel="nofollow">https://asciiflow.com/</a>)
</p>
<p></p>
<h1 id="DesignDocs-SiteConverterRoughDesign-Components">
 Components
</h1>
<p>
 See other documents for the details for each component.
</p>
<h2 id="DesignDocs-SiteConverterRoughDesign-GitHubActions">
 GitHub Actions
</h2>
<h2 id="DesignDocs-SiteConverterRoughDesign-Converter">
 Converter
</h2>
<p>
 Converter code is currently managed in my private repository not published to GitHub.
</p>
<p>
 In short, it fetches the pages by page id (e.g. 12345) and generates files (e.g. _pages/12345.html) for Jekyll with adding some Front Matter (<a href="http://jekyllrb-ja.github.io/docs/front-matter/" data-card-appearance="inline" class="external-link" rel="nofollow">http://jekyllrb-ja.github.io/docs/front-matter/</a> ) to help page generation.
</p>
<h2 id="DesignDocs-SiteConverterRoughDesign-GitHubPages">
 GitHub Pages
</h2>
<ul>
 <li>
  <p>
   published from <code>gh-pages</code> branch, with Jekyll-based GitHub-pages
  </p>
 </li>
 <li>
  <p>
   with custom domain text.sickhack.net.
  </p>
 </li>
</ul>
<p></p>
<p></p>
<h1 id="DesignDocs-SiteConverterRoughDesign-ConverterInternals">
 Converter Internals
</h1>
<h2 id="DesignDocs-SiteConverterRoughDesign-“concept”Definitions">
 “concept” Definitions
</h2>
<ul>
 <li>
  <p>
   A “tree”:
  </p>
  <ul>
   <li>
    <p>
     Pages under the specified “root” page in the source Confluence.
    </p>
   </li>
  </ul>
 </li>
 <li>
  <p>
   A “page”
  </p>
  <ul>
   <li>
    <p>
     a single page in the source Confluence
    </p>
   </li>
  </ul>
 </li>
 <li>
  <p>
   A “content”
  </p>
  <ul>
   <li>
    <p>
     API response fetched with Confluence API.
    </p>
   </li>
   <li>
    <p>
     especially “raw content” is the returned JSON returned
    </p>
   </li>
  </ul>
 </li>
</ul>
<h2 id="DesignDocs-SiteConverterRoughDesign-“verb”Definitions">
 “verb” Definitions
</h2>
<ul>
 <li>
  <p>
   Process (a tree/a page)
  </p>
  <ul>
   <li>
    <p>
     Fetch (a tree/a page)
    </p>
   </li>
   <li>
    <p>
     Analyze (a tree/a page)
    </p>
   </li>
   <li>
    <p>
     Convert (a tree/a page)
    </p>
   </li>
   <li>
    <p></p>
   </li>
  </ul>
 </li>
</ul>
<h2 id="DesignDocs-SiteConverterRoughDesign-CacheDirectoryStructure">
 Cache Directory Structure
</h2>
<ul>
 <li>
  <p>
   The cache directory is specified by the command-line option <code>--cache-dir</code>
  </p>
 </li>
</ul>
<p>
 TODO: write.
</p>
<h2 id="DesignDocs-SiteConverterRoughDesign-OutputDirectoryStructure">
 Output Directory Structure
</h2>
<p>
 TODO: write.
</p>
<p></p>
<h2 id="DesignDocs-SiteConverterRoughDesign-FlagsandPhasesRelationships">
 Flags and Phases Relationships
</h2>
<p>
 TODO: write.
</p>
<div>
 <table>
  <colgroup>
   <col>
   <col>
   <col>
  </colgroup>
  <tbody>
   <tr>
    <th>
     <p>
      <strong>Phase \ Flag</strong>
     </p>
    </th>
    <th>
     <ul>
      <li>
       <p>
        <code>root-page-id</code>
       </p>
      </li>
      <li>
       <p>
        <code>process-one-target-id</code>
       </p>
      </li>
     </ul>
    </th>
    <th>
     <ul>
      <li>
       <p>
        <code>use_cache</code>
       </p>
      </li>
      <li>
       <p>
        (and cache mode later)
       </p>
      </li>
     </ul>
    </th>
   </tr>
   <tr>
    <td>
     <p>
      fetch
     </p>
    </td>
    <td>
     <p></p>
    </td>
    <td>
     <p></p>
    </td>
   </tr>
   <tr>
    <td>
     <p>
      analyze
     </p>
    </td>
    <td>
     <p></p>
    </td>
    <td>
     <p></p>
    </td>
   </tr>
   <tr>
    <td>
     <p>
      convert
     </p>
    </td>
    <td>
     <p></p>
    </td>
    <td>
     <p></p>
    </td>
   </tr>
   <tr>
    <td>
     <p></p>
    </td>
    <td>
     <p></p>
    </td>
    <td>
     <p></p>
    </td>
   </tr>
  </tbody>
 </table>
</div>
<p></p>

